-- WAREHOUSE
USE ROLE SYSADMIN;

CREATE OR REPLACE WAREHOUSE STAGING
WAREHOUSE_SIZE=XSMALL
INITIALLY_SUSPENDED=TRUE
AUTO_SUSPEND=60
MAX_CLUSTER_COUNT=1;

-- ROLE/USER
USE ROLE USERADMIN;

CREATE ROLE STAGING ;
GRANT ROLE STAGING TO ROLE "SYSADMIN";

CREATE USER STAGING
LOGIN_NAME = STAGING
DISPLAY_NAME = STAGING
FIRST_NAME = STAGING
LAST_NAME = STAGING
DEFAULT_ROLE = STAGING
DEFAULT_WAREHOUSE = STAGING
MUST_CHANGE_PASSWORD = TRUE;

GRANT ROLE STAGING TO USER STAGING;

ALTER USER STAGING RESET PASSWORD;

-- DATABASES
USE ROLE SYSADMIN;

CREATE DATABASE STAGING_prod;
GRANT OWNERSHIP ON DATABASE STAGING_prod TO ROLE STAGING;
GRANT ALL PRIVILEGES ON DATABASE STAGING_prod TO ROLE STAGING;

CREATE DATABASE STAGING_PREP;
GRANT OWNERSHIP ON DATABASE STAGING_PREP TO ROLE STAGING;
GRANT ALL PRIVILEGES ON DATABASE STAGING_PREP TO ROLE STAGING;

CREATE DATABASE STAGING_RAW;
GRANT OWNERSHIP ON DATABASE STAGING_RAW TO ROLE STAGING;
GRANT ALL PRIVILEGES ON DATABASE STAGING_RAW TO ROLE STAGING;

GRANT OWNERSHIP ON ALL SCHEMAS IN DATABASE STAGING_RAW TO ROLE STAGING;
GRANT OWNERSHIP ON ALL SCHEMAS IN DATABASE STAGING_PREP TO ROLE STAGING;
GRANT OWNERSHIP ON ALL SCHEMAS IN DATABASE STAGING_PROD TO ROLE STAGING;

-- FILE FORMAT
USE ROLE STAGING;

CREATE FILE FORMAT STAGING_RAW.PUBLIC.CSV
TYPE = 'CSV' ESCAPE='\\' FIELD_OPTIONALLY_ENCLOSED_BY='"';
