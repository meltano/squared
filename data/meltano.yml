version: 1
send_anonymous_usage_stats: true
project_id: c15e971a-d318-4a9d-979b-1039ce5fd1b1
include_paths:
  - ./*.meltano.yml
plugins:
  extractors:
  - name: tap-csv
    variant: meltanolabs
    pip_url: git+https://github.com/MeltanoLabs/tap-csv.git
    config:
      files:
      - entity: slack_users
        path: /Users/pnadolny/Documents/Git/GitLab/squared/data/extract/orbit_slack_data/slack_users.csv
        keys:
        - Id
  - name: tap-google-analytics
    namespace: tap_google_analytics
    pip_url: git+https://github.com/MeltanoLabs/tap-google-analytics.git
    executable: tap-google-analytics
    capabilities:
    - catalog
    - discover
    - state
    settings:
    - name: start_date
      kind: date_iso8601
    - name: client_secrets
      kind: object
    config:
      view_id: '188392047' # CLI
      # view_id: '188274549' # Meltano Website
      # view_id: '188384771' # Meltano UI
      # view_id: '210710793' # Newsletter
      reports: ./extract/ga_reports/cli_events_report_definition.json
  - name: tap-athena
    namespace: tap_athena
    pip_url: git+https://github.com/pnadolny13/tap-athena.git@hard_fork_sdk_db_stream_stuff
    executable: tap-athena
    capabilities:
    - catalog
    - discover
    - state
    settings:
    - name: aws_access_key_id
      kind: password
    - name: aws_secret_access_key
      kind: password
    - name: s3_bucket
      kind: string
    - name: athena_database
      kind: string
    - name: s3_staging_dir
      kind: string
    - name: schema_name
      kind: string
    config:
      aws_region: us-east-2
      aws_access_key_id: ${AWS_ACCESS_KEY_ID}
      aws_secret_access_key: ${AWS_SECRET_ACCESS_KEY}
  - name: tap-athena-metrics
    inherit_from: tap-athena
    select:
    - '*fact_hub_metrics.repo_full_name'
    - '*fact_hub_metrics.created_at_timestamp'
    - '*fact_hub_metrics.last_push_timestamp'
    - '*fact_hub_metrics.last_updated_timestamp'
    - '*fact_hub_metrics.num_forks'
    - '*fact_hub_metrics.num_open_issues'
    - '*fact_hub_metrics.num_stargazers'
    - '*fact_hub_metrics.num_watchers'
    - '*fact_hub_metrics.meltano_exec_count_3m'
    - '*fact_hub_metrics.meltano_project_id_count_3m'
  - name: tap-athena-audit
    inherit_from: tap-athena
    select:
    - '*hub_metrics_audit.updated_date'
    - '*hub_metrics_audit.metric_type'
  - name: tap-gitlab
    variant: meltanolabs
    pip_url: git+https://github.com/MeltanoLabs/tap-gitlab.git
    # Excludes are for fields that cause errors
    select:
    - projects.*
    - '!projects.shared_with_groups'
    - '!projects.tag_list'
    - users.*
    - merge_requests.*
    - issues.*
    - branches.*
    - commits.*
    - '!commits.parent_ids'
    - groups.*
    - '!groups.projects'
    - project_labels.*
  loaders:
  - name: target-athena
    namespace: target_athena
    pip_url: git+https://github.com/pnadolny13/target-athena.git@fix_camel_case
    settings:
    - name: aws_access_key_id
      kind: password
    - name: aws_secret_access_key
      kind: password
    - name: s3_bucket
      kind: string
    - name: athena_database
      kind: string
    - name: s3_staging_dir
      kind: string
    - name: work_group
      kind: string
    - name: add_record_metadata
      kind: boolean
    - name: flatten_records
      kind: boolean
    - name: object_format
      kind: string
    config:
      aws_region: us-east-2
      aws_access_key_id: ${AWS_ACCESS_KEY_ID}
      aws_secret_access_key: ${AWS_SECRET_ACCESS_KEY}
      object_format: jsonl
      temp_dir: .output
      add_record_metadata: true
      flatten_records: true
  - name: target-yaml
    namespace: target_yaml
    pip_url: git+https://github.com/MeltanoLabs/target-yaml.git
    executable: target-yaml
    settings:
    - name: file_naming_scheme
      kind: string
    - name: timestamp_tz_offset
      kind: string
    - name: overwrite_behavior
      kind: string
    - name: record_insert_jsonpath
      kind: string
    - name: stream_maps
      kind: object
    config:
      file_naming_scheme: '{stream_name}.yml'
      timestamp_tz_offset: 0
      overwrite_behavior: replace_records

  - name: target-yaml-metrics
    inherit_from: target-yaml
    config:
      file_naming_scheme: metrics.yml
      overwrite_behavior: replace_file
      record_insert_jsonpath: $.metrics
      record_key_property_name: repo_full_name
      record_sort_property_name: repo_full_name
      default_yaml_template: |
        # This file is auto-generated by running `meltano elt tap-athena-metrics target-yaml-metrics`
        metrics: {}

  - name: target-yaml-audit
    inherit_from: target-yaml
    config:
      file_naming_scheme: audit.yml
      overwrite_behavior: replace_file
      record_insert_jsonpath: "$.audit_log"
      record_key_property_name: metric_type
      default_yaml_template: |
        # This file is auto-generated by running `meltano elt tap-athena-audit target-yaml-audit`
        audit_log: {}
  transformers:
  - name: dbt
    pip_url: git+https://github.com/Tomme/dbt-athena.git@c8e0458f85aaa8f9b693f99903ba95c41b90573b
    config:
      target: athena
  files:
  - name: dbt
    pip_url: git+https://gitlab.com/meltano/files-dbt.git@config-version-2
  utilities:
  - name: sqlfluff
    namespace: sqlfluff
    pip_url: sqlfluff[dbt]==0.7.1; sqlfluff-templater-dbt==0.7.1; git+https://github.com/Tomme/dbt-athena.git@c8e0458f85aaa8f9b693f99903ba95c41b90573b
    executable: sqlfluff
    config:
      athena_catalog: 'test'
      dbt_source_schema: 'abc'
      target: athena
      target_schema: target
      source_schema: source
      s3_stage: s3://test/foo
  - name: awscli
    namespace: awscli
    pip_url: awscli==1.21.7
    executable: aws
environments: []
