environments:
- name: dbt_dev
  annotations:
    docs:
      description: >
        Environment for developing dbt transforms separately from EL.
  config:
    plugins:
      utilities:
      - name: dbt-snowflake
        config:
          user: ${SNOWFLAKE_USER}
          role: ${SNOWFLAKE_USER}
          warehouse: CORE
          skip_pre_invoke: true
          database: USERDEV_PROD
          database_prep: USERDEV_PREP
          target_schema_prefix: ${SNOWFLAKE_USER}_
      - name: sqlfluff
        config:
          user: ${SNOWFLAKE_USER}
      - name: great_expectations
        config:
          prod_database: USERDEV_PROD
          raw_database: USERDEV_RAW
          username: ${SNOWFLAKE_USER}
          role: ${SNOWFLAKE_USER}
          warehouse: CORE
  env:
    USER_PREFIX: ${SNOWFLAKE_USER}
    SUPERSET_API_URL: http://localhost:8088
    SUPERSET_USER: admin
    SUPERSET_PASS: admin
    # https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html
    AIRFLOW__CORE__PLUGINS_FOLDER: $MELTANO_PROJECT_ROOT/orchestrate/plugins_local
    AIRFLOW__SCHEDULER__DAG_DIR_LIST_INTERVAL: '30'
    AIRFLOW_VAR_MELTANO_ENVIRONMENT: userdev
    AIRFLOW_VAR_OPERATOR_TYPE: bash
    # Secrets via KMS
    KMS_PUBLIC_KEY_PATH: utilities/kms/Publickey.pem
    KMS_DOTENV_PATH: .env
    KMS_SECRETS_PATH: secrets.yml
