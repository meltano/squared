environments:
- name: cicd
  config:
    plugins:
      extractors:
      - name: tap-cloudwatch
        config:
          start_date: ${DEFAULT_START_DATE_2HR}
      - name: tap-slack
        config:
          start_date: ${DEFAULT_START_DATE_4HR}
      - name: tap-slack-public
        config:
          start_date: ${DEFAULT_START_DATE_4HR}
      - name: tap-google-analytics
        config:
          start_date: ${DEFAULT_START_DATE_1D}
      - name: tap-gitlab
        config:
          start_date: ${DEFAULT_START_DATE_24HR}
      - name: tap-github
        config:
          start_date: ${DEFAULT_START_DATE_24HR}
      - name: tap-github-meltano
        config:
          start_date: ${DEFAULT_START_DATE_24HR}
      - name: tap-github-search
        config:
          start_date: ${DEFAULT_START_DATE_24HR}
          searches:
          # In CI we dont search forks and limit orgs to save time and requests
          - name: tap non-forks
            query: tap- fork:false language:Python singer in:readme org:MeltanoLabs
              org:transferwise
          - name: target non-forks
            query: target- fork:false language:Python singer in:readme org:MeltanoLabs
              org:transferwise
      # Reverse ETL connections:
      - name: tap-snowflake
        config:
          dbname: CICD_PROD
          user: CICD
          role: CICD
          warehouse: CICD
      - name: tap-snowflake-metrics-legacy
        config:
          tables: CICD_PROD.${CI_BRANCH}_MELTANO_HUB.FACT_HUB_METRICS
      - name: tap-snowflake-metrics
        config:
          tables: CICD_PROD.${CI_BRANCH}_MELTANO_HUB.FACT_VARIANT_HUB_METRICS
      - name: tap-snowflake-audit
        config:
          tables: CICD_PROD.${CI_BRANCH}_MELTANO_HUB.HUB_METRICS_AUDIT
      - name: tap-snowflake-singer-activity
        config:
          tables: CICD_PROD.${CI_BRANCH}_SLACK_NOTIFICATIONS.SLACK_ALERTS
      - name: tap-snowflake-meltano-activity
        config:
          tables: CICD_PROD.${CI_BRANCH}_SLACK_NOTIFICATIONS.GITHUB_ACTIVITY_NOTIFICATIONS
      loaders:
      - name: target-snowflake
        config:
          dbname: CICD_RAW
          user: CICD
          role: CICD
          warehouse: CICD
          default_target_schema: ${CI_BRANCH}_${MELTANO_EXTRACT__LOAD_SCHEMA}
      # Excluded from CI for now
      # - name: target-apprise-singer-activity
      #   config:
      #     stream_maps:
      #       CICD_PROD-${CI_BRANCH}_SLACK_NOTIFICATIONS-SLACK_ALERTS:
      #         title: TITLE
      #         body: BODY
      # - name: target-apprise-meltano-activity
      #   config:
      #     stream_maps:
      #       CICD_PROD-${CI_BRANCH}_SLACK_NOTIFICATIONS-GITHUB_ACTIVITY_NOTIFICATIONS:
      #         title: TITLE
      #         body: BODY
      utilities:
      - name: dbt-snowflake
        config:
          user: CICD
          role: CICD
          warehouse: CICD
          database: CICD_PROD
          database_prep: CICD_PREP
          database_raw: CICD_RAW
          source_schema_prefix: ${CI_BRANCH}_
          target_schema_prefix: ${CI_BRANCH}_
      - name: sqlfluff
        config:
          user: CICD
          role: CICD
          warehouse: CICD
      - name: great_expectations
        config:
          prod_database: CICD_PROD
          raw_database: CICD_RAW
          username: CICD
          role: CICD
          warehouse: CICD
  env:
    # Required to be set in environment
    # DEFAULT_START_DATE_1D: "2023-02-10 01:00:00"
    AIRFLOW__CORE__PLUGINS_FOLDER: $MELTANO_PROJECT_ROOT/orchestrate/plugins_local
    AIRFLOW_VAR_OPERATOR_TYPE: bash
