environments:
- name: prod
  config:
    plugins:
      extractors:
      - name: tap-google-analytics
        config:
          start_date: '2021-11-08'
      - name: tap-athena
        config:
          schema_name: dbt_prod
          s3_staging_dir: s3://prod-meltano-bucket-01/data/raw01/tap-athena/
          s3_bucket: prod-meltano-bucket-01
      - name: tap-gitlab
        config:
          groups: meltano
          start_date: '2020-01-01T00:00:00Z'
      - name: tap-github
        config:
          start_date: '2020-01-01'
      - name: tap-snowflake
        config:
          dbname: PROD
          user: MELTANO
          role: REPORTER
          tables: PROD.*.*
          warehouse: REPORTER
      loaders:
      - name: target-athena
        config:
          s3_bucket: prod-meltano-bucket-01
          athena_database: prod01_raw
          s3_staging_dir: s3://prod-meltano-bucket-01/data/raw01/target-athena/
      - name: target-snowflake
        config:
          dbname: RAW
          user: MELTANO
          role: LOADER
          warehouse: LOADER
      transformers:
      - name: dbt
        config:
          source_schema: prod01_raw
          target_schema: dbt_prod
          sf_user: MELTANO
          sf_role: TRANSFORMER
          sf_database_raw: RAW
          sf_database_prep: PREP
          sf_database_prod: PROD
          sf_warehouse: TRANSFORMER
  env:
    DBT_ATHENA_S3_STAGE: s3://prod-meltano-bucket-01/data/raw01/dbt/
    ATHENA_CATALOG: awsdatacatalog
    HUB_METRICS_S3_PATH: s3://prod-meltano-bucket-01/hub_metrics/
    RAW_SCHEMA: prod01_raw
    DBT_SCHEMA: dbt_prod
    PERMISSION_BOT_USER: permission_bot
    PERMISSION_BOT_WAREHOUSE: ADMIN
    PERMISSION_BOT_DATABASE: SNOWFLAKE_SAMPLE_DATA
    PERMISSION_BOT_ROLE: SECURITYADMIN
- name: userdev
  config:
    plugins:
      extractors:
      - name: tap-google-analytics
        config:
          start_date: '2021-11-01'
      - name: tap-athena
        config:
          schema_name: dbt_dev_${USER_PREFIX}
          s3_staging_dir: s3://devtest-meltano-bucket-01/data/raw01/tap-athena/
          s3_bucket: devtest-meltano-bucket-01
      - name: tap-gitlab
        config:
          groups: meltano
          start_date: '2022-02-06T00:00:00Z'
      - name: tap-github
        config:
          start_date: '2022-02-15'
      - name: tap-snowflake
        config:
          dbname: ${USER_PREFIX}_PROD
          user: ${USER_PREFIX}
          role: ${USER_PREFIX}
          warehouse: CORE
      - name: tap-snowflake-metrics
        config:
          # TODO: once the table exists filter for it properly
          tables: ${USER_PREFIX}_PROD.PUBLIC.FACT_HUB_METRICS
      loaders:
      - name: target-athena
        config:
          s3_bucket: devtest-meltano-bucket-01
          athena_database: dev01_${USER_PREFIX}_raw
          s3_staging_dir: s3://devtest-meltano-bucket-01/data/raw01/target-athena/
      - name: target-snowflake
        config:
          dbname: ${USER_PREFIX}_RAW
          user: ${USER_PREFIX}
          role: ${USER_PREFIX}
          warehouse: CORE
      transformers:
      - name: dbt
        config:
          source_schema: dev01_${USER_PREFIX}_raw
          target_schema: dbt_dev_${USER_PREFIX}
          sf_user: ${USER_PREFIX}
          sf_role: ${USER_PREFIX}
          sf_database_raw: ${USER_PREFIX}_RAW
          sf_database_prep: ${USER_PREFIX}_PREP
          sf_database_prod: ${USER_PREFIX}_PROD
          sf_warehouse: CORE
  env:
    USER_PREFIX: melty
    DBT_ATHENA_S3_STAGE: s3://devtest-meltano-bucket-01/data/raw01/dbt/
    ATHENA_CATALOG: awsdatacatalog
    SUPERSET_API_URL: http://localhost:8088
    SUPERSET_USER: admin
    SUPERSET_PASS: admin
    # https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html
    AIRFLOW__CORE__PLUGINS_FOLDER: $MELTANO_PROJECT_ROOT/orchestrate/plugins_local
    AIRFLOW__SCHEDULER__DAG_DIR_LIST_INTERVAL: '30'
    AIRFLOW_VAR_MELTANO_ENVIRONMENT: userdev
    AIRFLOW_VAR_OPERATOR_TYPE: bash
