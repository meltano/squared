environments:
- name: prod
  config:
    plugins:
      extractors:
      - name: tap-google-analytics
        config:
          start_date: '2022-02-20'
      - name: tap-gitlab
        config:
          groups: meltano
          start_date: '2020-01-01T00:00:00Z'
      - name: tap-github
        config:
          start_date: '2020-01-01'
      - name: tap-snowflake
        config:
          dbname: PROD
          user: MELTANO
          role: REPORTER
          warehouse: REPORTER
      - name: tap-snowflake-metrics
        config:
          tables: PROD.MELTANO_HUB.FACT_HUB_METRICS
      - name: tap-snowflake-audit
        config:
          tables: PROD.MELTANO_HUB.HUB_METRICS_AUDIT
      loaders:
      - name: target-snowflake
        config:
          dbname: RAW
          user: MELTANO
          role: LOADER
          warehouse: LOADER
      transformers:
      - name: dbt
        config:
          sf_user: MELTANO
          sf_role: TRANSFORMER
          sf_database_raw: RAW
          sf_database_prep: PREP
          sf_database_prod: PROD
          sf_warehouse: TRANSFORMER
      utilities:
      - name: sqlfluff
        config:
          sf_user: MELTANO
      - name: great_expectations
        config:
          prod_database: PROD
          raw_database: RAW
          username: MELTANO
          role: TRANSFORMER
          warehouse: TRANSFORMER
  env:
    HUB_METRICS_S3_PATH: s3://prod-meltano-bucket-01/hub_metrics/
    PERMISSION_BOT_USER: permission_bot
    PERMISSION_BOT_WAREHOUSE: ADMIN
    PERMISSION_BOT_DATABASE: SNOWFLAKE_SAMPLE_DATA
    PERMISSION_BOT_ROLE: SECURITYADMIN
- name: userdev
  config:
    plugins:
      extractors:
      - name: tap-google-analytics
        config:
          start_date: '2022-02-20'
      - name: tap-gitlab
        config:
          groups: meltano
          start_date: '2020-01-01T00:00:00Z'
      - name: tap-github
        config:
          start_date: '2021-05-01'
      - name: tap-snowflake
        config:
          dbname: ${USER_PREFIX}_PROD
          user: ${USER_PREFIX}
          role: ${USER_PREFIX}
          warehouse: CORE
      - name: tap-snowflake-metrics
        config:
          tables: ${USER_PREFIX}_PROD.MELTANO_HUB.FACT_HUB_METRICS
      - name: tap-snowflake-audit
        config:
          tables: ${USER_PREFIX}_PROD.MELTANO_HUB.HUB_METRICS_AUDIT
      loaders:
      - name: target-snowflake
        config:
          dbname: ${USER_PREFIX}_RAW
          user: ${USER_PREFIX}
          role: ${USER_PREFIX}
          warehouse: CORE
      transformers:
      - name: dbt
        config:
          sf_user: ${USER_PREFIX}
          sf_role: ${USER_PREFIX}
          sf_database_raw: ${USER_PREFIX}_RAW
          sf_database_prep: ${USER_PREFIX}_PREP
          sf_database_prod: ${USER_PREFIX}_PROD
          sf_warehouse: CORE
      utilities:
      - name: sqlfluff
        config:
          sf_user: ${USER_PREFIX}
      - name: great_expectations
        config:
          prod_database: ${USER_PREFIX}_PROD
          raw_database: ${USER_PREFIX}_RAW
          username: ${USER_PREFIX}
          role: ${USER_PREFIX}
          warehouse: CORE
  env:
    USER_PREFIX: melty
    SUPERSET_API_URL: http://localhost:8088
    SUPERSET_USER: admin
    SUPERSET_PASS: admin
    # https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html
    AIRFLOW__CORE__PLUGINS_FOLDER: $MELTANO_PROJECT_ROOT/orchestrate/plugins_local
    AIRFLOW__SCHEDULER__DAG_DIR_LIST_INTERVAL: '30'
    AIRFLOW_VAR_MELTANO_ENVIRONMENT: userdev
    AIRFLOW_VAR_OPERATOR_TYPE: bash
- name: cicd
  config:
    plugins:
      extractors:
      - name: tap-slack
        config:
          start_date: "${DEFAULT_START_DATE}"
      - name: tap-google-analytics
        config:
          start_date: "${DEFAULT_START_DATE}"
      - name: tap-gitlab
        config:
          groups: meltano
          start_date: "${DEFAULT_START_DATE}"
      - name: tap-github
        config:
          start_date: "${DEFAULT_START_DATE}"
      - name: tap-github-labs
        config:
          start_date: "${DEFAULT_START_DATE}"
      - name: tap-github-search
        config:
          start_date: "${DEFAULT_START_DATE}"
      # Reverse ETL connections:
      - name: tap-snowflake
        config:
          dbname: CICD_PROD
          user: ${USER_PREFIX}
          password: ${SF_PASSWORD}
          role: ${USER_PREFIX}
          warehouse: CORE
      - name: tap-snowflake-metrics
        config:
          tables: CICD_PROD.MELTANO_HUB.FACT_HUB_METRICS
      - name: tap-snowflake-audit
        config:
          tables: CICD_PROD.MELTANO_HUB.HUB_METRICS_AUDIT
      loaders:
      - name: target-snowflake
        config:
          target: snowflake_cicd
          dbname: CICD_RAW
          user: ${SF_USER}
          password: ${SF_PASSWORD}
          role: ${SF_ROLE}
          warehouse: CORE
      transformers:
      - name: dbt
        config:
          sf_user: ${SF_USER}
          sf_role: ${SF_ROLE}
          sf_password: ${SF_PASSWORD}
          sf_database_raw: CICD_RAW
          sf_database_prep: CICD_PREP
          sf_database_prod: CICD_PROD
          sf_warehouse: CORE
      utilities:
      - name: sqlfluff
        config:
          sf_user: ${SF_USER}
          sf_password: ${SF_PASSWORD}
      - name: great_expectations
        config:
          prod_database: CICD_PROD
          raw_database: CICD_RAW
          username: ${SF_USER}
          password: ${SF_PASSWORD}
          role: ${SF_ROLE}
          warehouse: CORE
  env:
    SF_USER: melty
    SF_ROLE: melty
    SF_PASSWORD: ${SNOWFLAKE_PASSWORD}
    # Restrict date for faster CI/CD runs:
    DEFAULT_START_DATE: "2022-04-01"
