dags:
  daily_dashboard:
    interval: '0 10 * * *'
    steps:
      - name: mart_dbt_snowflake
        cmd: 'meltano invoke dbt:run --models marts.*'
        retries: 2
      - name: mart_dbt_test
        cmd: 'meltano invoke dbt:test --models marts.*'
        retries: 2
        depends_on:
          - mart_dbt_snowflake
  hub_metrics:
    interval: '0 10 * * *'
    steps:
      - name: dbt_hub_metrics
        cmd: 'meltano invoke dbt:run --models publish.meltano_hub.*'
        retries: 2
      - name: ge_consumption_validate
        cmd: 'meltano invoke great_expectations:test_dbt_hub_metrics'
        retries: 2
        depends_on:
          - dbt_hub_metrics
      - name: publish_hub_metrics
        cmd: 'meltano elt tap-snowflake-metrics target-yaml-metrics && meltano invoke awscli s3 cp metrics.yml s3://prod-meltano-bucket-01/hub_metrics/'
        retries: 2
        depends_on:
          - ge_consumption_validate
      - name: publish_audit
        cmd: 'meltano elt tap-snowflake-audit target-yaml-audit && meltano invoke awscli s3 cp audit.yml s3://prod-meltano-bucket-01/hub_metrics/'
        retries: 2
        depends_on:
          - ge_consumption_validate
  google_analytics:
    interval: '0 6 * * *'
    steps:
      - name: tap_google_analytics_target_snowflake
        cmd: 'meltano elt tap-google-analytics target-snowflake-google-analytics --job_id=ga_snowflake'
        retries: 2
      - name: ge_raw_validate
        cmd: 'meltano invoke great_expectations:test_ga_raw'
        retries: 2
        depends_on:
          - tap_google_analytics_target_snowflake
      - name: dbt_google_analytics_run_stage
        cmd: 'meltano invoke dbt:run --models staging.google_analytics.*'
        retries: 2
        depends_on:
          - ge_raw_validate
  slack:
    interval: '0 6 * * *'
    steps:
      - name: tap_slack_target_snowflake
        cmd: 'meltano elt tap-slack target-snowflake-slack --job_id=tap_slack_target_snowflake'
        retries: 2
      - name: dbt_slack_run_stage
        cmd: 'meltano invoke dbt:run --models staging.slack.*'
        retries: 2
        depends_on:
          - tap_slack_target_snowflake
      - name: dbt_slack_test_stage
        cmd: 'meltano invoke dbt:test --models staging.slack.*'
        retries: 2
        depends_on:
          - dbt_slack_run_stage
  gitlab:
    interval: '0 6 * * *'
    steps:
      - name: tap_gitlab_target_snowflake
        cmd: 'meltano elt tap-gitlab target-snowflake-gitlab --job_id=tap_gitlab_target_snowflake'
        retries: 2
      - name: dbt_gitlab_run_models
        cmd: 'meltano invoke dbt:run --models staging.gitlab.*'
        retries: 2
        depends_on:
          - tap_gitlab_target_snowflake
      - name: dbt_gitlab_test_models
        cmd: 'meltano invoke dbt:test --models staging.gitlab.*'
        retries: 2
        depends_on:
          - dbt_gitlab_run_models
  github_labs:
    interval: '0 6 * * *'
    steps:
      - name: tap_github_target_snowflake
        cmd: 'meltano elt tap-github-labs target-snowflake-github-labs --job_id=tap_github_labs_target_snowflake'
        retries: 2
      - name: dbt_github_labs_run_models
        cmd: 'meltano invoke dbt:run --models staging.github_labs.*'
        retries: 2
        depends_on:
          - tap_github_target_snowflake
      - name: dbt_github_labs_test_models
        cmd: 'meltano invoke dbt:test --models staging.github_labs.*'
        retries: 2
        depends_on:
          - dbt_github_labs_run_models
  github_search:
    interval: '0 6 * * *'
    steps:
      - name: tap_github_search_target_snowflake
        cmd: 'meltano elt tap-github-search target-snowflake-github-search --job_id=tap_github_search_target_snowflake'
        retries: 2
      - name: dbt_github_search_run_models
        cmd: 'meltano invoke dbt:run --models staging.github_search.*'
        retries: 2
        depends_on:
          - tap_github_search_target_snowflake
      - name: dbt_github_search_test_models
        cmd: 'meltano invoke dbt:test --models staging.github_search.*'
        retries: 2
        depends_on:
          - dbt_github_search_run_models
